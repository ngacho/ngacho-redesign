/*! For license information please see blogEditor.js.LICENSE.txt */
(()=>{"use strict";var e={"./app/controller/edit-blog-controller.js":(e,t,s)=>{s.r(t),s.d(t,{EditBlogController:()=>i});class i{constructor(e,t){this.model=e,this.view=t,this.blogId="",this.init()}init(){let e=decodeURI(location.search);this.blogId=e.slice(1),this.blogId?(this.fetchBlog(this.blogId),this.view.bindHandlePublish(this.handleEditBlog)):this.view.bindHandlePublish(this.handlePublishNewBlog)}fetchBlog(e){this.model.fetchBlogFromDb(e).then((e=>{this.view.setUpBlog(e)})).catch((e=>console.log(e)))}handleEditBlog=async e=>this.model.updateBlog({id:this.blogId,...e});handlePublishNewBlog=async e=>this.model.publishNewBlog(e)}},"./app/model/base-models/base-model.js":(e,t,s)=>{s.r(t),s.d(t,{BaseModel:()=>i});class i{constructor(e){this.baseUrl=e}async getList(){return new Promise(((e,t)=>{fetch(this.baseUrl,{credentials:"include"}).then((s=>{Promise.all([s.json(),s.status]).then((([s,i])=>{200===i?e(s):(console.log(err),t(`Failed with response ${i}`))})).catch((e=>{console.log(e),t(`Failed response: ${e}`)}))})).catch((e=>{console.log(e),t("Failed to fetch")}))}))}async getListByTag(e){return new Promise(((t,s)=>{fetch(`${this.baseUrl}/tags/${encodeURIComponent(e)}`).then((e=>{Promise.all([e.json(),e.status]).then((([e,i])=>{200===i?t(e):s(`Failed with response ${i}`)})).catch((e=>{s(`Failed response: ${e}`)}))})).catch((e=>s("Failed to fetch")))}))}async getListItemById(e,t){return new Promise(((s,i)=>{fetch(`${this.baseUrl}/${e}/${t}`,{credentials:"include"}).then((e=>{Promise.all([e.json(),e.status]).then((([e,t])=>{200===t?s(e):i(`Failed with response ${t}`)})).catch((e=>{i("Failed response")}))})).catch((()=>i("Failed to fetch id")))}))}async createItem(e){const t={doc:e},s={method:"POST",headers:new Headers({"Content-Type":"application/json"}),credentials:"include",body:JSON.stringify(t)};return new Promise(((e,t)=>{fetch(this.baseUrl,s).then((s=>{Promise.all([s.text(),s.status]).then((([s,i])=>{200===i?e("Success"):t(`Failed with response ${i}`)})).catch((e=>{console.error(`ERROR LEVEL 2: ${e}`),t("Failed response")}))})).catch((e=>{console.error(`ERROR LEVEL 1: ${e}`),t("Failed response.")}))}))}async createFileItem(e,t){const s=new FormData;s.append("file",e),s.append("doc",JSON.stringify(t));const i={method:"POST",credentials:"include",body:s};return new Promise(((e,t)=>{fetch(this.baseUrl,i).then((s=>{Promise.all([s.text(),s.status]).then((([s,i])=>{200===i?e("Success"):t(`Failed with response ${i}`)})).catch((e=>{console.error(`ERROR LEVEL 2: ${e}`),t("Failed response")}))})).catch((e=>{console.error(`ERROR LEVEL 1: ${e}`),t("Failed response.")}))}))}async updateFileItemObject(e,t){const s=new FormData;s.append("file",e),s.append("doc",JSON.stringify(t));const i={method:"PUT",body:s,credentials:"include"};return new Promise(((e,s)=>{fetch(`${this.baseUrl}/${t.id}`,i).then((t=>{Promise.all([t.text(),t.status]).then((([t,i])=>{200===i?e("Success"):s(`Failed with response ${i}`)})).catch((e=>{console.error(`ERROR LEVEL 2: ${e}`),s("Failed response")}))})).catch((e=>{console.error(`ERROR LEVEL 1: ${e}`),s("Failed response.")}))}))}async updateItem(e){const t={doc:e},s={method:"PUT",headers:new Headers({"Content-Type":"application/json"}),credentials:"include",body:JSON.stringify(t)};return new Promise(((t,i)=>{fetch(`${this.baseUrl}/${e.id}`,s).then((e=>{Promise.all([e.text(),e.status]).then((([e,s])=>{200===s?t("Success"):(console.error(`ERROR LEVEL 2: ${e}`),i(`Failed with response ${s}`))})).catch((e=>{console.error(`ERROR LEVEL 2: ${e}`),i("Failed response")}))})).catch((e=>{console.error(`ERROR LEVEL 1: ${e}`),i("Failed response.")}))}))}async updateItemStatus(e){return new Promise(((t,s)=>{fetch(`${this.baseUrl}/set-active/${e}`,{method:"PUT",credentials:"include"}).then((e=>{Promise.all([e.json(),e.status]).then((([e,i])=>{200===i?t("Success"):s(`Failed with response ${i}`)})).catch((e=>{s("Failed response")}))})).catch((e=>{s("Failed")}))}))}async deleteItem(e){return new Promise(((t,s)=>{fetch(`${this.baseUrl}/${e}`,{method:"DELETE",credentials:"include"}).then((e=>{Promise.all([e.text(),e.status]).then((([e,i])=>{200===i?t("Success"):s(`Failed with response ${i}`)})).catch((e=>{s("Failed response")}))})).catch((e=>{s("Failed to delete text")}))}))}}},"./app/model/base-models/blog-model.js":(e,t,s)=>{s.r(t),s.d(t,{BlogModel:()=>l});var i=s("./app/model/base-models/base-model.js");class l{constructor(){this.baseModel=new i.BaseModel("https://api.ngacho.com/database/blogs")}async addBlog(e){return this.baseModel.createItem(e)}async editBlog(e){return this.baseModel.updateItem(e)}async getBlogs(){return this.baseModel.getList()}async getBlog(e,t=!1){return this.baseModel.getListItemById(e,t)}async deleteBlogById(e){return this.baseModel.deleteItem(e)}async getBlogsByTags(e){return this.baseModel.getListByTag(e)}}},"./app/model/edit-blog-model.js":(e,t,s)=>{s.r(t),s.d(t,{EditBlogModel:()=>l});var i=s("./app/model/base-models/blog-model.js");class l extends i.BlogModel{constructor(){super()}async fetchBlogFromDb(e){return await this.getBlog(e,!0)}async updateBlog(e){return await this.editBlog(e)}async publishNewBlog(e){return await this.addBlog(e)}}},"./app/view/blog/admin/edit-blog-view.js":(e,t,s)=>{s.r(t),s.d(t,{EditBlogView:()=>i});class i{constructor(){this.blogTitleField=document.querySelector(".title"),this.articleField=document.querySelector(".article"),this.postDescriptField=document.querySelector(".post-descript"),this.tagsField=document.querySelector(".tags"),this.publishBtn=document.querySelector(".publish-btn"),this.blog_options=document.querySelector(".blog-options"),this.blog_div=document.querySelector(".blog"),this.blogPublishedDate="",this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.blogPrevContainer=document.querySelector(".blog-content"),this.blogTitlePreviewField=document.querySelector(".blog-heading-preview"),this.blogTimePreviewField=document.querySelector(".blog-time-preview"),this.blogPostDescriptPreviewField=document.querySelector(".post-description-preview"),this.blogPostPreviewField=document.querySelector(".blog-post-article-preview"),this.blogTitleField.addEventListener("input",(()=>{var e=this.blogTitleField.value;const t=this.parseMarkdown(e);this.blogTitlePreviewField.innerHTML=t})),this.postDescriptField.addEventListener("input",(()=>{var e=this.postDescriptField.value;const t=this.parseMarkdown(e);this.blogPostDescriptPreviewField.innerHTML=t})),this.articleField.addEventListener("input",(()=>{var e=this.articleField.value;const t=this.parseMarkdown(e);this.blogPostPreviewField.innerHTML=t}))}setUpBlog(e){this.blogTitleField.value=e.title;let t=e.tags.join(", ");this.tagsField.value=t,this.postDescriptField.value=e.descript,this.articleField.value=e.text,this.blogPublishedDate=e.publishedAt,this.setUpPreviewBlogPreview(e)}publishBlog(e){if(this.articleField.value.length&&this.blogTitleField.value.length){var t=document.createElement("div");t.id="snackbar",t.className="edit-snack-bar";var s=document.createTextNode("Edits Published");t.appendChild(s),this.blog_div.appendChild(t);var i=document.querySelector(".edit-snack-bar");let l=new Date;e({title:this.blogTitleField.value,tags:this.tagsField.value.split(",").map((e=>e.trim())).filter((e=>e)),descript:this.postDescriptField.value,text:this.articleField.value,publishedAt:this.blogPublishedDate,lastModified:`${l.getDate()} ${this.months[l.getMonth()]} ${l.getFullYear()}`}).then((e=>{i.className="show",setTimeout((function(){i.className=i.className.replace("show","")}),1e3),console.info("success")})).catch((e=>{console.error(e)}))}}bindHandlePublish(e){this.publishBtn.addEventListener("click",(t=>{this.publishBlog(e)}))}setUpPreviewBlogPreview(e){var t=document.createTextNode(e.title);this.blogTitlePreviewField.appendChild(t);var s=document.createTextNode(e.publishedAt);this.blogTimePreviewField.appendChild(s);var i=e.descript;if(i){var l=document.createTextNode(i);this.blogPostDescriptPreviewField.appendChild(l)}this.blogPostPreviewField.innerHTML=e.html}parseMarkdown(e){var t=new showdown.Converter;return e.replace(/\$(.*?)\$|([^$]+)/g,((e,s,i)=>s?katex.renderToString(s,{throwOnError:!1,trust:!0}):t.makeHtml(i)))}}}},t={};function s(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{s.r(i);var e=s("./app/controller/edit-blog-controller.js"),t=s("./app/model/edit-blog-model.js"),l=s("./app/view/blog/admin/edit-blog-view.js");new e.EditBlogController(new t.EditBlogModel,new l.EditBlogView)})()})();
//# sourceMappingURL=blogEditor.js.map